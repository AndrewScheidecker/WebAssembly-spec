(module
    (memory 4096)

    (import $resize_memory "wasm_intrinsics" "resize_memory" (param i32))
    (import $memory_size "wasm_intrinsics" "memory_size" (param) (result i32))
    (import $page_size "wasm_intrinsics" "page_size" (param) (result i32))

    (export "load" $load)
    (func $load (param $i i32) (result i32) (i32.load (get_local $i)))

    (export "store" $store)
    (func $store (param $i i32) (param $v i32) (i32.store (get_local $i) (get_local $v)))

    (export "resize" $resize)
    (func $resize (param $sz i32) (call_import $resize_memory (get_local $sz)))

    (export "size" $size)
    (func $size (result i32) (call_import $memory_size))
)

(assert_eq (invoke "size") (i32.const 4096))
(invoke "store" (i32.const 0) (i32.const 42))
(assert_eq (invoke "load" (i32.const 0)) (i32.const 42))
(assert_fault (invoke "store" (i32.const 4096) (i32.const 42)) "runtime: out of bounds memory access")
(assert_fault (invoke "load" (i32.const 4096)) "runtime: out of bounds memory access")
(invoke "resize" (i32.const 8192))
(assert_eq (invoke "size") (i32.const 8192))
(assert_eq (invoke "load" (i32.const 0)) (i32.const 42))
(assert_eq (invoke "load" (i32.const 4096)) (i32.const 0))
(invoke "store" (i32.const 4096) (i32.const 43))
(assert_eq (invoke "load" (i32.const 4096)) (i32.const 43))
(invoke "resize" (i32.const 4096))
(assert_eq (invoke "size") (i32.const 4096))
(assert_eq (invoke "load" (i32.const 0)) (i32.const 42))
(assert_fault (invoke "store" (i32.const 4096) (i32.const 42)) "runtime: out of bounds memory access")
(assert_fault (invoke "load" (i32.const 4096)) "runtime: out of bounds memory access")
